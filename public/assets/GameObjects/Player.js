const server="http://localhost:3000",socket=io.connect(server,{transports:["websocket","polling","flashsocket"],upgrade:!1,reconnection:!1});import{getSignWithOne,randomIntFromInterval}from"../libs/Dazzle.js";import Bullet from"./Bullet.js";export default{color:"rgba(255, 255, 255, 0)",width:30,height:30,tags:["player"],custom:{local:!1,size:10,speedX:0,speedY:0,maxSpeed:500,moveLeft:!1,moveRight:!1,moveUp:!1,moveDown:!1,shotDelay:250,bulletsPool:10,bullets:[],createBullets:e=>{for(e.bullets=[];e.bullets.length<e.bulletsPool;){var o=e.scene.game.instantGameObject({...Bullet,x:e.x,y:e.y,color:e.playerColor,custom:{...Bullet.custom,playerID:e.id}});e.bullets.push(o)}},shot:e=>{var o=e.maxSpeed*getSignWithOne(e.headPosition)+1.25*e.speedX,t=e.bullets.shift(),s={x:e.x+(1==getSignWithOne(e.headPosition)?e.width:-e.size),y:e.y+e.size};t.shot(t,s.x,s.y,o),e.bullets.push(t)},death:e=>{e.x=0,e.y=0,e.sendSocket(e)},sendSocket:e=>{socket.emit("player",{id:e.id,x:e.x,y:e.y,playerColor:e.playerColor,speedX:e.speedX,speedY:e.speedY,moveUp:e.moveUp,moveDown:e.moveDown,moveLeft:e.moveLeft,moveRight:e.moveRight,headPosition:e.headPosition})},sendSocketTimeout:e=>setTimeout(()=>{e.sendSocket(e),e.sendSocketTimeout(e)},1e3)},load:e=>{e.power=e.maxSpeed/12.5,e.headPosition=e.size,e.local&&(e.playerColor=`
                rgb(
                    ${randomIntFromInterval(100,255)},
                    ${randomIntFromInterval(100,255)},
                    ${randomIntFromInterval(100,255)}
                )`,e.createBullets(e),e.sendSocketTimeout(e))},update:e=>{e.scene.game.ctx.fillStyle=e.playerColor,e.scene.game.ctx.fillRect(e.x,e.y,2*e.size,e.size),e.scene.game.ctx.fillRect(e.x+e.headPosition,e.y+e.size,2*e.size,e.size),e.scene.game.ctx.fillRect(e.x,e.y+2*e.size,2*e.size,e.size);var o=e.scene.worldLimit,o=(e.x+3*e.size>o&&(e.moveRight=!1,e.x=o-3*e.size),e.x-e.size<-o&&(e.moveLeft=!1,e.x=-o+e.size),e.y<-o&&(e.moveUp=!1,e.y=-o),e.y+3*e.size>o&&(e.moveDown=!1,e.y=o-3*e.size),e.moveRight&&e.speedX<e.maxSpeed&&(e.speedX+=e.power),!e.moveRight&&0<e.speedX&&(e.speedX-=e.power),e.moveLeft&&e.speedX>-e.maxSpeed&&(e.speedX-=e.power),!e.moveLeft&&e.speedX<0&&(e.speedX+=e.power),e.moveDown&&e.speedY<e.maxSpeed&&(e.speedY+=e.power),!e.moveDown&&0<e.speedY&&(e.speedY-=e.power),e.moveUp&&e.speedY>-e.maxSpeed&&(e.speedY-=e.power),!e.moveUp&&e.speedY<0&&(e.speedY+=e.power),e.scene.game.deltaTime);e.x+=e.speedX*o,e.y+=e.speedY*o},keyDown:({event:e,current:o})=>{o.local&&("w"==e.key?o.moveUp=!0:"s"==e.key?o.moveDown=!0:"a"==e.key?(o.moveLeft=!0,o.headPosition=-o.size):"d"==e.key&&(o.moveRight=!0,o.headPosition=o.size),o.sendSocket(o))},keyUp:({event:e,current:o})=>{o.local&&("w"==e.key&&(o.moveUp=!1),"s"==e.key&&(o.moveDown=!1),"a"==e.key&&(o.moveLeft=!1),"d"==e.key&&(o.moveRight=!1),o.sendSocket(o))},mouseDown:({current:e})=>{e.local&&(e.shot(e),socket.emit("shot",e.id))},onCollide:({current:e,target:o})=>{o.tags.includes("bullet")&&o.active&&e.id!=o.playerID&&(o.disable(o),e.death(e))}};